apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- external.yaml
- storage-class.yaml
# - nfs-rbac.yaml
# - ingress.yaml
helmCharts:
- name: rook-ceph
  repo: https://charts.rook.io/release
  version: v1.11.7
  releaseName: rook-ceph
  namespace: rook-ceph
  includeCRDs: true
  valuesInline:
    resources:
      limits:
        cpu: 200m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
    csi:
      enableCephfsDriver: false
      enableGrpcMetrics: false
      # Set to true to enable host networking for CSI CephFS and RBD nodeplugins. This may be necessary
      # in some network configurations where the SDN does not provide access to an external cluster or
      # there is significant drop in read/write performance.
      enableCSIHostNetwork: false
      # set to false to disable deployment of snapshotter container in CephFS provisioner pod.
      enableCephfsSnapshotter: false
      # set to false to disable deployment of snapshotter container in NFS provisioner pod.
      enableNFSSnapshotter: false
      # set to false to disable deployment of snapshotter container in RBD provisioner pod.
      enableRBDSnapshotter: true
      # set to false if the selinux is not enabled or unavailable in cluster nodes.
      enablePluginSelinuxHostMount: false
      # set to true to enable Ceph CSI pvc encryption support.
      enableCSIEncryption: false
      csiRBDProvisionerResource: |
        - name : csi-provisioner
          resource:
            requests:
              memory: 128Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 100m
        - name : csi-resizer
          resource:
            requests:
              memory: 128Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 100m
        - name : csi-attacher
          resource:
            requests:
              memory: 128Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 100m
        - name : csi-snapshotter
          resource:
            requests:
              memory: 128Mi
              cpu: 100m
            limits:
              memory: 256Mi
              cpu: 200m
        - name : csi-rbdplugin
          resource:
            requests:
              memory: 256Mi
              cpu: 200m
            limits:
              memory: 512Mi
              cpu: 200m
        - name : csi-omap-generator
          resource:
            requests:
              memory: 256Mi
              cpu: 200m
            limits:
              memory: 512Mi
              cpu: 200m
        - name : liveness-prometheus
          resource:
            requests:
              memory: 128Mi
              cpu: 50m
            limits:
              memory: 256Mi
              cpu: 100m
# - name: rook-ceph-cluster
#   repo: https://charts.rook.io/release
#   version: v1.10.4
#   releaseName: rook-ceph-cluster
#   namespace: rook-ceph
#   includeCRDs: true
#   valuesInline:
#     cephClusterSpec:
#       external: 
#         enabled: true
#       dashboard:
#         ssl: false
#     toolbox: 
#       enabled: true


# patches:
#   - patch: |
#       apiVersion: batch/v1
#       kind: Job
#       metadata:
#         name: hook
#       $patch: delete
#     target:
#       annotationSelector: "helm.sh/hook=pre-delete"
